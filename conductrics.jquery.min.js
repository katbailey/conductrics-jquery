(function(){var e,t=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1};e=jQuery;window.conductrics=function(n){var r,s,o,u,a,f,l,c,h,p,d,v,m,g;c=e.extend(true,{baseUrl:"http://api.conductrics.com",apiKey:null,agent:null,session:null,timeout:1e3,caching:false,cachingMaxAge:30*60,sessionCookies:false,sessionCookieName:"mpid",sessionCookieOptions:{path:"/"}},n);o=function(t,n,r,i){var s;if(r.session===null&&c.sessionCookies){s=e.cookie(c.sessionCookieName);if(s){r.session=s}}if(r.session===null&&window.XDomainRequest){r.session=a()}if(r.session===null){delete r.session}return e.ajax({url:t,type:n,dataType:"json",data:r,timeout:c.timeout,success:function(t,n,r){if(c.sessionCookies&&t!==null&&t.session!==null){e.cookie(c.sessionCookieName,t.session,c.sessionCookieOptions)}if(typeof i==="function"){return i(t,n,r)}},error:function(e,t,n){if(typeof i==="function"){return i(null,t,e)}},xhrFields:{withCredentials:true}})};s=function(e,t){return[c.baseUrl,c.owner,t.agent].concat(e).join("/")};a=function(){var t,n,r,i;t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890".split("");n=function(e){return e[Math.floor(Math.random()*e.length)]};r=function(e,r){if(r===null){r=""}while(r.length<e){r+=n(t)}return r};i=e.cookie("conductrics-id");if(i===void 0){i=r(32,"cond-");e.cookie("conductrics-id",i)}return i};r=function(){if(console&&console.log){return console.log(arguments)}};u=function(e,t){var n,i,s;for(i=0,s=t.length;i<s;i++){n=t[i];if(e[n]===void 0){r("Conductrics plugin cannot proceed because option '"+n+"' is not provided.");return false}}return true};g=function(e){return e!==null&&e.length>0&&e.length<25&&!/[^0-9A-Za-z_-]/.test(e)};l=function(e){if(!e){return""}return f(e.split(",")).join(",")};f=function(e){var t,n,r,s;if(!e){return[]}t=[];for(r=0,s=e.length;r<s;r++){n=e[r];if(g(n)){t.push(e[i])}}return t};m=function(){var e;if(c.caching!=="localStorage"){return false}try{return t.call(window,"localStorage")>=0&&window["localStorage"]!==null}catch(n){e=n;return false}};h=function(e,t){var n,r,i,s,o;n=[];r=["baseUrl","owner","agent","session"];for(s=0,o=r.length;s<o;s++){i=r[s];if(e[i]!==null){n.push(e[i])}else if(c[i]!==null){n.push(c[i])}}if(t){n.push(t)}return n.join(":")};d=function(e,t,n){var r,i,s,o;if(!m()){return n}s=localStorage;r=h(e,t);o=s.getItem(r);if(o){i=JSON.parse(o);if(i.val){return i.val}}return n};v=function(e,t,n){var r,i,s;if(!m()){return}s=localStorage;r=h(e,t);i={ts:(new Date).getTime(),val:n};return s.setItem(r,JSON.stringify(i))};p=function(){var e,t,n,r;if(!m()){return}n=localStorage;for(e in n){r=n[e];if(e.indexOf([c.baseUrl,c.owner].join(":")===0)){if(r){t=JSON.parse(r);if(t.ts&&t.ts+c.cachingMaxAge*1e3<(new Date).getTime()){n.removeItem(e)}}}}};p();return{getDecision:function(t,n){var r,i,a,f;t=e.extend({agent:c.agent,session:c.session,decision:"decision-1",choices:["a","b"]},t);if(!u(t,["agent"])){return}if(!u(c,["baseUrl","owner","apiKey"])){return}f=s(["decisions",t.choices.toString()],t);r={apikey:c.apiKey};if(t.session!==null){r.session=t.session}if(t.features){r.features=l(t.features)}if(typeof t.choices==="number"){a={code:0}}else if(typeof t.choices.join==="function"){a={code:t.choices[0]}}if(c.caching){i=d(t,"dec");if(i&&i[t.decision]){a=i[t.decision];if(typeof n==="function"){n.apply(this,[a,null,"stored",null]);return}}}o(f,"GET",r,function(e,r,i){if(r==="success"){a=e.decisions[t.decision];if(c.caching&&a){v(t,"dec",e.decisions)}}if(typeof n==="function"){return n.apply(this,[a,e,r,i])}});return this},sendGoal:function(t,n){var r,i;t=e.extend({agent:c.agent,session:c.session,reward:null,goal:"goal-1"},t);i=s(["goal",t.goal],t);r={apikey:c.apiKey};if(t.reward){r.reward=t.reward}if(t.session){r.session=t.session}return o(i,"POST",r,function(e,t,r){if(typeof n==="function"){return n.apply(this,[e,t,r])}})},expireSession:function(t,n){var r,i;t=e.extend({agent:c.agent,session:c.session},t);i=s(["expire"],t);r={apikey:c.apiKey};if(t.session){r.session=t.session}o(i,"GET",r,function(e,t,r){if(typeof n==="function"){return n.apply(this,[e,t,r])}});return this}}};e.fn.extend({conductrics:function(t){var n,r;r=function(e,t){switch(e){case"show":return t.show();case"hide":return t.hide();default:throw new Error("invalid operation")}};n={toggle:function(t,n){var i,s;if(!t.conductrics_api){throw new Error("no conductrics instance")}i=e(this);s=e.extend({choices:["show","hide"],initial:"hide"},t);r(s.initial,i);s.conductrics_api.getDecision(s,function(e){return r(e.code,i)});return this},"redirect-to-best-url":function(t,n,r){var i,s;if(!n.conductrics_api){throw new Error("no conductrics instance")}i=e.extend({},n);i.choices=t.length;s=t[0];i.conductrics_api.getDecision(i,function(e){if(e.code!==null){return s=t[e.code]}});window.location.replace(s);return this}};if(n[t]){return n[t].apply(this,Array.prototype.slice.call(arguments,1))}}})}).call(this)